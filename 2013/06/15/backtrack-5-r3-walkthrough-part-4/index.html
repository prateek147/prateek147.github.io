
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Backtrack 5 R3 Walkthrough part 4 - Prateek Gianchandani</title>
  <meta name="author" content="Prateek Gianchandani">

  
  <meta name="description" content="Backtrack 5 R3 Walkthrough Part 4 Jun 15th, 2013 Posted by Prateek Gianchandani DHCPig DHCPig is a very nice and handy little tool used to carry out &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://prateek147.github.io/2013/06/15/backtrack-5-r3-walkthrough-part-4">
  <link href="/favicon.png" rel="icon">
  <link href='http://fonts.googleapis.com/css?family=Quicksand:300,400' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Prateek Gianchandani" type="application/atom+xml">
  <script src="/js/jquery.js"></script>
  <script src="/js/bootstrap-collapse.js"></script>
  <script src="/js/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js" type="text/javascript"></script>
<style>
body {
    -moz-transform: scale(0.9, 0.9); /* Moz-browsers */
    zoom: 0.2; /* Other non-webkit browsers */
    zoom: 20%; /* Webkit browsers */
    transform: scale(1.9);
    transform-origin: 90% 90%;
}
</style>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-41877509-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <div class="navbar navbar-inverse navbar-static-top">
  	<div class="navbar-inner">
  	  <div class="container">
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".navbar-responsive-collapse">
          <span class="fui-menu-24"></span>
        </a>
  	  	<div class="nav-collapse collapse navbar-responsive-collapse" style="height:0;">
  	      <ul class="nav">
    
        <li ><a href="/index.html">Home</a></li>
    
        <li ><a href="/security/">Security</a></li>
    
        <li ><a href="/ios/">iOS Development</a></li>
    
        <li ><a href="/everest/">Everest</a></li>
    
        <li ><a href="/archives/index.html">Archives</a></li>
    
        <li ><a href="http://damnvulnerableiosapp.com">DVIA</a></li>
    
        <li ><a href="/about/">About Me</a></li>
    
        <li ><a href="/hire-me/">Hire Me</a></li>
    
</ul>

<ul class="nav pull-right">
    
    <li><a href="http://github.com/prateek147" title="Github Profile"><i class="icon-github-sign social-navbar"></i></a></li>
    
    
    <li><a href="http://linkedin.com/in/prateekgianchandani" title="Linkedin Profile"><i class="icon-linkedin-sign social-navbar"></i></a></li>
    
    
    <li><a href="http://twitter.com/prateekg147" title="Twitter Profile"><i class="icon-twitter-sign social-navbar"></i></a></li>
    
    
    
    <li><a href="http://facebook.com/prateek.gianchandani" title="Facebook Profile"><i class="icon-facebook-sign social-navbar"></i></a></li>
    
</ul>

  	    </div>
  	  </div>
  	</div>
  </div>
  <div class="container" id="main">
    <div class="span12">
      <div class="row-fluid">
        <div id="content">
          <div>
<article class="hentry" role="article">
  

  <header>
  <div class="jumbotron">
    Backtrack 5 R3 Walkthrough Part 4
	<h5>








  


<i class="icon-calendar-empty"></i> <time datetime="2013-06-15T03:33:00+04:00" pubdate data-updated="true">Jun 15<span>th</span>, 2013</time></h5>
  <h4>
  

<p>Posted by <a href="http://highaltitudehacks.com/about/">Prateek Gianchandani</a></p>
<h4>
  </div>
</header>
  <div class="row-fluid">
    <div class="span12">
      <h2>DHCPig</h2>




<p>DHCPig is a very nice and handy little tool used to carry out an advanced DHCP exhaustion attack. It does this by grabbing all the IP addresses in its subnet by sending different DHCP requests for those IP addresses. It also finds out its neighbour&#8217;s IP addresses in its vicinity and releases their IP addresses by sending DHCP releases to the server. It then waits for a specific timeout on its sent packets, and if the timeout is reached, it means all the IP addresses in the network are now used up.However, some neighbours may still have IP addresses on the network that will have IP addresses conflicting with the IP addresses taken up the attacking machine. In this case, DHCpig can also knock all the windows systems offline by sending gratuitous ARP requests from all the IP address in the network. A gratuitous ARP request is used to check for duplicate IP addresses. If there is another device on the network using the same IP address (our attacking machine), the windows machine will receive an ARP reply from the attacker&#8217;s machine. This way, the Window&#8217;s machine will know that it has an IP address conflict with another system on the network. As a result, it will try to obtain another IP address but since all the IP addresses are now exhausted, it wont be able to get a new IP address. </p>




<!-- more -->




<p>Running DHCPig is as simple as giving just the interface as the argument. Type the command as shown in the figure below to run DHCPig. In the figure below, DHCpig tries to gather all the IP addresses in the network.</p>


<p><img src="/images/posts/bt5r4/1.png" width="833" height="519" alt="1"></p>

<p>At the same time, it also sending DHCPRELEASE for the neighbors that it found on the network.</p>


<p><img src="/images/posts/bt5r4/2.png" width="707" height="496" alt="2"></p>

<p>Once this process is done, it will wait for a timeout for allocation of an IP address and if the timeout occurs, it will try to knock all the systems (windows based) offline by sending gratuitous ARP requests from their IP addresses. Note that this technique won&#8217;t work on a linux based system mainly because linux systems will hold on to their IP addresses even if they detect a conflict in the IP address.</p>


<p><img src="/images/posts/bt5r4/3.png" width="817" height="522" alt="3"></p>

<p>If you want to know more about DHCpig, check out its <a href ="https://github.com/kamorin/DHCPig">github page</a>.</p>




<h2>MitmProxy</h2>




<p>MitmProxy is an SSL capable HTTP proxy. It provides a console interface that allows the functionality of inspecting and manipulating traffic on the fly by acting as a man in the middle. Mitmdump is the command line version of mitmproxy. We can also save traffic flowing through the proxy for later analysis, and we can also replay the captured traffic whenever we want. We can also write python scripts to manipulate the traffic on the fly. MitmProxy can be found under the following directory in Backtrack 5 R3.</p>


<p><img src="/images/posts/bt5r4/4.png" width="645" height="121" alt="4"></p>

<p>To run MitmProxy, just type ./mitmproxy and it will start the program. By default, mitmproxy listens on port 8080. Hence all the traffic passing through port 8080 would be seen by mitmproxy. Before we configure our browser to use port 8080 as a proxy, lets type &#8220;?&#8221; and see the different options that are available to us.</p>


<p><img src="/images/posts/bt5r4/5.png" width="1097" height="647" alt="5"></p>

<p>Now, configure your browser to use port 8080 on localhost as a proxy. Using our browser, lets now browse to a particular website. You will see that all the requests are being seen by mitmproxy. Notice the 2 arrows &#8220;>>&#8221;. It shows you to select different request/reponse and perform actions on them. You can switch between different request/response using the j and k keys. Intercepted responses will be shown in an orange text. Currently there are no intercepted responses mainly because we haven&#8217;t configured mitmproxy to intercept any kind of response. Also, you can see the event log by holding down the &#8220;e&#8221; key.</p>


<p><img src="/images/posts/bt5r4/6.png" width="1132" height="629" alt="6"></p>

<p>We can also select a particular flow and look at the details of it. To select any particular flow just take the pointer (the double arrows) next to it and press enter.</p>


<p><img src="/images/posts/bt5r4/7.png" width="1129" height="197" alt="7"></p>

<p>Here you will see all the details of this request. You can also see the response by switching to the response tab. To switch to the response tab, just press Tab. </p>


<p><img src="/images/posts/bt5r4/8.png" width="1129" height="629" alt="8"></p>

<p>At any time, you can just press q to go back. Let&#8217;s now take a look at how mitmproxy can be used to intercept traffic and modify it. Mitmproxy interception works by taking certain intereption patterns which are python style regular expressions. A complete list of filter expressions can be found on http://mitmproxy.org/doc/filters.html.</p>




<p>Let&#8217;s set up a simple filter here. To set up an interception filter, just press &#8220;i&#8221;.</p>


<p><img src="/images/posts/bt5r4/9.png" width="1131" height="39" alt="9"></p>

<p>In this case i am going to set up a filter which looks for the string &#8220;ping&#8221; in the body and intercepts the request/response if found.</p>


<p><img src="/images/posts/bt5r4/10.png" width="1130" height="42" alt="10"></p>

<p>Now lets browse over to ping.com from our browser. You will notice that the response gets intercepted. Intercepted request/reponse are marked with orange text.</p>


<p><img src="/images/posts/bt5r4/11.png" width="1061" height="96" alt="11"></p>

<p>If you want, you can edit the response before it is displayed in the browser. Just take your pointer over to it and press enter. Then press Tab to switch to the intercepted response. To edit the response, just press the &#8220;e&#8221; key and it will ask you which part of the response (code, message, header, raw body) you can edit. In this case, lets select header.</p>


<p><img src="/images/posts/bt5r4/12.png" width="1130" height="631" alt="12"></p>

<p>Once you select header, you will be taken to an editor where you can edit the headers. In this case, i can just set the Cache-Control header value to &#8220;no-cache&#8221;.</p>


<p><img src="/images/posts/bt5r4/13.png" width="1131" height="221" alt="13"></p>

<p>Now we need to forward the response, just keep pressing q until you go to the main page where you will see all the flows, then select the flow that was just intercepted.</p>


<p><img src="/images/posts/bt5r4/14.png" width="1131" height="39" alt="14"></p>

<p>Now press a to forward this response. You will see that the page will now load up in the browser and the subsequent requests/responses will now show up.</p>


<p><img src="/images/posts/bt5r4/15.png" width="1130" height="315" alt="15"></p>

<p>You can also save all the traffic from mitmproxy to an output file. Just use the -w command to specify the output file name and mitmproxy will write all the traffic that it sees onto the output file. In this case, i save all the traffic to a file named capturedTraffic.</p>


<p><img src="/images/posts/bt5r4/17.png" width="791" height="117" alt="17"></p>

<p>Now i can replay all this traffic again whenever i want. Just use the following command to replay the traffic again. This feature could be very useful in automating certain tasks such as connecting to a network or downloading something from a particular url etc. The -n option asks mitmdump to start mitmdump without binding to a particular port.</p>


<p><img src="/images/posts/bt5r4/18.png" width="1134" height="269" alt="18"></p>

<p>You can also use python scripts to modify the traffic programatically. The examples folder in mitmproxy contains a set of sample scripts that can help you do the task. ALl these scripts use the mitmproxy API to help perform the task. To know more about the mitmproxy API, go to http://mitmproxy.org/doc/scripts.html</p>




<p>To use the script, just use the -s option and give the location of the script. In this case we will be using a simple script called upsidedowninternet.py that will check for PNG&#8217;s in the response and make them upside down.</p>


<p><img src="/images/posts/bt5r4/19.png" width="801" height="28" alt="19"></p>

<p>And the result is images upside down. :). In later articles, we will learn about how we can use Mitmproxy to intercept SSL requests.</p>


<p><img src="/images/posts/bt5r4/20.png" width="957" height="586" alt="20"></p>

<h2>References:</h2>




<ul>
     <li><p>DHCPig</br><a href ="https://github.com/kamorin/DHCPig">https://github.com/kamorin/DHCPig</a></p>
     </li>
     <li><p>MitmProxy official website</br><a href ="http://mitmproxy.org">http://mitmproxy.org</a></p>
     </li>
</ul>




<p>This article was originally published on the <a href="http://resources.infosecinstitute.com/">resources</a> page at <a href="http://infosecinstitute.com/">Infosec Institute</a>. For more information, please visit my author <a href="http://resources.infosecinstitute.com/author/prateek/">page</a>.</p>


    </div>
  </div>



  <footer>
    <hr>
    
    <div class="row-fluid">
      
      <div class="span6">
        <p class="meta">
        
        



  <a href="//categories/backtrack/"><span class="badge">backtrack</span></a>

  <a href="//categories/security/"><span class="badge">security</span></a>




        </p>
      </div>
      
      <div class="span6 social-sharing">
        <div class="sharing">
  <div class="addthis_toolbox addthis_default_style ">
  
  <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
  
  
  <a class="addthis_button_tweet"></a>
  
  
  <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>

      </div>
      
      
    </div>
    
    <div class="row-fluid">
      <div class="span12">
        <p class="meta">
          
            <a class="basic-alignment left" href="/2013/06/15/backtrack-5-r3-walkthrough-part-3" title="Previous Post: Backtrack 5 R3 Walkthrough part 3">&laquo; Backtrack 5 R3 Walkthrough part 3</a>
          
          
            <a class="basic-alignment right" href="/2013/06/15/ghost-usb-honeypot-part-1-interview-with-project-leader-sebastian-poeplau" title="Next Post: Ghost USB Honeypot Part 1- Interview with Project Leader Sebastian Poeplau">Ghost USB Honeypot Part 1- Interview with Project Leader Sebastian Poeplau &raquo;</a>
          
        </p>
      </div>
    </div>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>



        </div>
      </div>
      <div class="row-fluid">
        <footer class="footer-page" role="contentinfo">
          <p>
  Copyright &copy; 2014 - Prateek Gianchandani -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span> - Theme by <a href="http://alexgaribay.com">Alex Garibay</a>
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41877509-1', 'highaltitudehacks.com');
  ga('send', 'pageview');

</script>

<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=9078428; 
var sc_invisible=1; 
var sc_security="a08bf0bd"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="web analytics"
href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="http://c.statcounter.com/9078428/0/a08bf0bd/1/"
alt="web analytics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
        </footer>
      </div>
    </div>
  </div>
  

<script type="text/javascript">
      var disqus_shortname = 'highaltitudehacks';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://prateek147.github.io/2013/06/15/backtrack-5-r3-walkthrough-part-4';
        var disqus_url = 'http://prateek147.github.io/2013/06/15/backtrack-5-r3-walkthrough-part-4';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
