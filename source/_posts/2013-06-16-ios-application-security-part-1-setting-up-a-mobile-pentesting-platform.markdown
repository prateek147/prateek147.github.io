---
layout: post
title: "IOS Application security Part 1 - Setting up a mobile pentesting platform"
date: 2013-06-16 02:53
comments: true
categories: [ios, security]
---


<p>In this article series, we will be learning about the tools and techniques required to perform penetration testing and Vulnerability assessment on IOS Applications.</p>

<h2>Jailbreaking your device</h2>

<p>If you are serious about IOS security, then having a jailbroken device is a must. In this section, we will look at how we can jailbreak an IOS device. Jailbreaking a device has many advantages. You can install tools like nmap, metasploit and even run your own custom python code on the device. Imagine having the power to run a vulnerability scan on a website from the palm of your hand. To know more about jailbreaking and the advantages of doing it, i recommend you have a look at <a href ="http://www.ibtimes.com/why-jailbreak-your-iphone-5-reasons-you-should-download-evasi0n-jailbreak-ios-6-1080412">this</a> article.</p>


<p>Jailbreaking your device is as simple as downloading a jailbreaking software and clicking on jailbreak. <!-- more --> I would recommend you use <a href = "http://evasi0n.com/">evasi0n</a> to jailbreak if your device if your device is running IOS 6.x and <a href ="http://www.redsn0w.us/">redsn0w</a> if your device is running IOS 5.x.</p>
	
<p>In this case, i am going to jailbreak my new Ipad (3rd generation) running IOS 6.0.1. Once you download evasi0n and run it, you will see that it automatically detects the device and tells you if a jailbreak is available for it or not.</p>

<img src="/images/posts/ios1/1.png" width="482" height="344" alt="1">

<p>All you have to do is click on Jailbreak and let evasi0n do all the magic.</p>

<img src="/images/posts/ios1/2.png" width="484" height="343" alt="2">

<p>As you can see, the jailbreak process has started. After some time, evasi0n will reboot the device and run the exploit.</p>

<img src="/images/posts/ios1/3.png" width="483" height="345" alt="3">

<p>Once it is done running the exploit, it will install Cydia and its packages list on the device. Cydia is a GUI that allows you to download software packages and other apps  on your jailbroken device that you would normally not find on the App store. Mostly all the jailbreak softwares install Cydia on your device by default. You can call Cydia the App Store for jailbroken devices.</p>

<img src="/images/posts/ios1/4.png" width="480" height="344" alt="4">

<p>Wait for some more time until you get this prompt</p>

<img src="/images/posts/ios1/5.png" width="483" height="344" alt="5">

<p>If you go to your device, you will see that a new app icon named <em>Jailbreak</em> has come up. Tap on it to finish the jailbreak process.</p>

<img src="/images/posts/ios1/6.PNG" width="640" height="480" alt="6">

<p>You will see that your device will reboot. Please wait patiently and wait for the process to finish. Once the device has finished rebooting, you will see that a new app named <em>Cydia</em> appears on your apps list. This is an indication that your device has been successfully jailbroken.</p>

<p>Congratulations, you have made the first leap in the field of IOS hacking.</p>

<h2>Setting up a mobile auditing platform</h2>

<p>Now that you are done jailbreaking your device, the next step is to install some of the very important linux command line tools such as <em>wget, ps, apt-get</em> and other applications used for auditing an IOS application. The first and foremost thing however is to install <em>OpenSSH</em> on your device. This will allow you to login to your jailbroken device and perform various other tasks as we will see in this article later.</p>

<p>Go to Cydia, tap on the search tab on the bottom and search for OpenSSH.</p>

<img src="/images/posts/ios1/7.PNG" width="640" height="1136" alt="7">

<p>Tap on OpenSSH and on the next view tap on install. Tap on Confirm on the next view to confirm this action.</p>

<img src="/images/posts/ios1/8.PNG" width="640" height="1136" alt="8">

<p>This will insall OpenSSH on your device.</p>

<p>Before we use ssh to log in to the device, we should install some other command line tools also. Almost all the popular hacker tools can be installed by using the <em>BigBoss Recommended tools</em> package which comes with a list of hacker tools. To install <em>BigBoss Recommended tools</em> just search for it in Cydia and tap on install.</p>

<img src="/images/posts/ios1/9.PNG" width="640" height="1136" alt="9">

<p> Some of the important command line tools that it installs are <em>APT 0.6 Transitional, Git, GNU Debugger, less, make, unzip, wget and SQLite 3.x</em> </p>

<p>One more thing that we can do is install <em>MobileTerminal</em> from Cydia. It allow you to run terminal commands on your device from your device rather than logging in via ssh from a different system. Again, downloading <em>MobileTerminal</em> on your device is as simple as searching for it in Cydia and tapping on Install</p>


<img src="/images/posts/ios1/10.PNG" width="640" height="1136" alt="10">

<p>Once it is installed, you will see  a new app icon with the name <em>Terminal</em>.</p>

<img src="/images/posts/ios1/11.PNG" width="640" height="1136" alt="11">

<p>Tap on it, you will be given a terminal. Now try and run any Unix command on it. In this case, let me get a list of all the running processes by using the command <em>ps</em></p>

<img src="/images/posts/ios1/12.PNG" width="640" height="1136" alt="12">

<p> As you can see, it works !</p>

<p>Let's see if we can login to our jailbroken device using ssh. Make sure your laptop and the device are connected to the same network and then find out the IP address of the device. To find out the IP address of your device, just go to <em>Settings -> Wi-Fi</em> and then click on the network your device is connected to.</p>

<img src="/images/posts/ios1/13.PNG" width="640" height="1136" alt="13">

<p>As we can see, the IP address is <em>192.168.2.3</em>. Let's ssh to it as the user <em>root</em>. Just type in the follwing command as shown below.The default password for the user root is <em>alpine</em>. It is recommended that you should change your password as soon as you have Open SSH installed. This is because there has been many malwares which log in to your device and steal information by using the default username/password combination. To change the password, just type in <em>passwd</em> and then type the new password twice. This will change the password for the user <em>root</em>.All of these steps have been perfomed in the image shown below.</p>

<img src="/images/posts/ios1/14.png" width="839" height="206" alt="14">

<p><em>Note:Make sure the app Cydia is in the background while running any command that requires root privileges. This is because Cydia runs as root and hence it wouldn't be possible to get a lock on a process which is already being used by Cydia.</em></p>

<p>Once this is done, do an <em>apt-get update</em> to get the latest packages lists.</p>

<img src="/images/posts/ios1/15.png" width="1094" height="522" alt="15">

<p>It wouldn't be a bad idea to do an <em>apt-get upgrade</em> also. This will fetch the new versions of packages that are already existing on the machine and don't have the latest version using the information contained from doing an <em>apt-get update</em>.</p>

<img src="/images/posts/ios1/16.png" width="852" height="249" alt="16">


<p>The next thing to do is to install class-dump-z which we will be using to dump class information from an IOS application. To get the application, go to its <a href="https://code.google.com/p/networkpx/wiki/class_dump_z">official page</a> and copy the link for the latest version. At the time of writing of this article, the latest version is 0.2a.</p>
	
<img src="/images/posts/ios1/17.png" width="1049" height="543" alt="17">

<p>Now, ssh into your device and fetch the file from that link using the command <em>wget</em>.</p>

<img src="/images/posts/ios1/18.png" width="979" height="187" alt="18">

<p>Another option would have been to download file on your system and then upload it to your device using <em>sftp</em>. Once the download has finished, use the tar program to extract the archive.</p>

<img src="/images/posts/ios1/19.png" width="519" height="301" alt="19">

<p>Once this is done, go inside the folder <em>iphone_armv6</em> and copy the <em>class-dump-z</em> executable into <em>/usr/bin</em> directory. This will make sure you can run <em>class-dump-z</em> from anywhere on the device. Once you have copied the executable, just type <em>class-dump-z</em>. If you get the output as shown in the figure below, this means that <em>class-dump-z</em> has been successfully installed. </p>

<img src="/images/posts/ios1/20x.png" width="664" height="649" alt="20x">



<h2>Further Reading</h2>

<p>There are not a lot of resources as far as IOS Security is concerned but here are some of the very good ones.</p>

<ul>
	<li><a href="http://www.securitytube.net/">SecurityTube</a> has a very detailed course on IOS security.</li>
	<li><a href="http://www.securitylearn.net/">Security Learn</a> has some very good articles on penetration testing of IOS Applications.</li>
	<li><a href="http://www.amazon.com/Hacking-Securing-iOS-Applications-Hijacking/dp/1449318746">Hacking and Securing IOS applications</a> is probably the best book i have read that deals with attacking IOS applications</li>
	<li><a href="https://blog.lookout.com/">Lookout's</a> blog is also another valuable resource in learning about the latest techniques and exploits in the mobile world.</li>
		
</ul>

<h2>Conclusion</h2>
	
<p>In this article, we learned how to setup a mobile auditing environment on a jailbroken device.  In the next article we will look at how we can analyze applications for class information using class-dump-z.</p>

<p>This article was originally published on the <a href="http://resources.infosecinstitute.com/">resources</a> page at <a href="http://infosecinstitute.com/">Infosec Institute</a>. For more information, please visit my author <a href="http://resources.infosecinstitute.com/author/prateek/">page</a>.</p>

